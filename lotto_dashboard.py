import streamlit as st
import pandas as pd
import json

# JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
with open("lotto_100.json", "r", encoding="utf-8") as f:
    data = json.load(f)
df = pd.DataFrame(data)

st.set_page_config(page_title="ë¡œë˜ í†µê³„ ëŒ€ì‹œë³´ë“œ", layout="wide")

st.title("ğŸ¯ ë¡œë˜ í†µê³„ ëŒ€ì‹œë³´ë“œ")
st.caption("ìµœê·¼ 100ê°œ íšŒì°¨ ê¸°ì¤€ | ë™í–‰ë³µê¶Œ API ê¸°ë°˜")

# íšŒì°¨ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
df = df.sort_values(by="round", ascending=False)

# ì»¬ëŸ¼ í•œê¸€ëª… ë§¤í•‘ (ë³´ê¸° í¸í•˜ê²Œ)
df.rename(columns={
    "round": "íšŒì°¨",
    "first_prize": "1ë“± ë‹¹ì²¨ê¸ˆ",
    "first_total_prize": "1ë“± ì´ ë‹¹ì²¨ê¸ˆ",
    "first_winner_count": "1ë“± ë‹¹ì²¨ì ìˆ˜",
    "sales": "ì´ íŒë§¤ê¸ˆì•¡"
}, inplace=True)

st.subheader("ğŸ“ˆ 1ë“± ë‹¹ì²¨ê¸ˆ ì¶”ì´ (íšŒì°¨ ê¸°ì¤€)")
st.line_chart(df.set_index("íšŒì°¨")[["1ë“± ë‹¹ì²¨ê¸ˆ"]])

st.subheader("ğŸ† 1ë“± ë‹¹ì²¨ì ìˆ˜")
st.bar_chart(df.set_index("íšŒì°¨")[["1ë“± ë‹¹ì²¨ì ìˆ˜"]])

st.subheader("ğŸ’° ì´ íŒë§¤ê¸ˆì•¡")
st.line_chart(df.set_index("íšŒì°¨")[["ì´ íŒë§¤ê¸ˆì•¡"]])

st.subheader("ğŸ”¢ ë‹¹ì²¨ë²ˆí˜¸ ë¶„í¬ (ì¶œí˜„ ë¹ˆë„ìˆœ)")

# ëª¨ë“  íšŒì°¨ì˜ ë‹¹ì²¨ë²ˆí˜¸ë¥¼ í•˜ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ë¡œ í•©ì¹˜ê¸°
from collections import Counter
all_numbers = sum(df["numbers"], [])  # ë¦¬ìŠ¤íŠ¸ ì•ˆ ë¦¬ìŠ¤íŠ¸ â†’ í‰íƒ„í™”
counter = Counter(all_numbers)

# ë°ì´í„°í”„ë ˆì„ ë³€í™˜ í›„ ì •ë ¬
freq_df = pd.DataFrame(counter.items(), columns=["ë²ˆí˜¸", "ì¶œí˜„ ë¹ˆë„"]).sort_values(by="ì¶œí˜„ ë¹ˆë„", ascending=False)

# ê·¸ë˜í”„ ì¶œë ¥
st.bar_chart(freq_df.set_index("ë²ˆí˜¸"))

st.subheader("ğŸ“‹ ì „ì²´ ì›ì‹œ ë°ì´í„° ë³´ê¸°")
st.dataframe(df, use_container_width=True)
